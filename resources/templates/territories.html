{% extends "base.html" %}
{% block content %}

<link rel="stylesheet" href="http://openlayers.org/en/v3.10.1/css/ol.css" type="text/css">
<style>
    .map {
        height: 400px;
        width: 600px;
    }
</style>
<script src="http://openlayers.org/en/v3.10.1/build/ol.js" type="text/javascript"></script>

<h2>Territories</h2>

{% for territory in territories %}
<h3>{{ territory.name }}: {{ territory.address }}</h3>

<div id="map-{{ territory.id }}" class="map"></div>
<script type="text/javascript">
    (function () {

        var territoryArea = new ol.format.WKT().readFeature('{{ territory.area }}');
        territoryArea.getGeometry().transform('EPSG:4326', 'EPSG:3857');
        var territorySource = new ol.source.Vector({
            features: [territoryArea]
        });
        var territoryStyles = [
            new ol.style.Style({
                stroke: new ol.style.Stroke({
                    color: 'rgba(255, 0, 0, 1.0)',
                    width: 3
                }),
                fill: new ol.style.Fill({
                    color: 'rgba(255, 0, 0, 0.1)'
                })
            })
        ];
        var territoryLayer = new ol.layer.Vector({
            source: territorySource,
            style: territoryStyles
        });

        var streetsLayer = new ol.layer.Tile({
            source: new ol.source.OSM()
        });

        var map = new ol.Map({
            target: 'map-{{ territory.id }}',
            layers: [streetsLayer, territoryLayer],
            view: new ol.View({
                center: ol.proj.fromLonLat([0.0, 0.0]),
                zoom: 1
            })
        });
        map.getView().fit(territorySource.getExtent(), map.getSize());

    })();
</script>
{% endfor %}

<h2>Import</h2>

<form action="/territories" method="post" enctype="multipart/form-data">
    {% csrf-field %}
    <p>Territories GeoJSON: <input type="file" name="territories"></p>
    <button type="submit" class="btn btn-primary">Import</button>
</form>

{% endblock %}
